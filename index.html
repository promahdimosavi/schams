<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اتصال به کیف پول Tonkeeper</title>
    <script src="https://cdn.jsdelivr.net/npm/tonweb/dist/tonweb.bundle.min.js"></script>
</head>
<body>
    <h1>اتصال به کیف پول Tonkeeper</h1>
    <button id="connectButton">اتصال به کیف پول</button>
    <div id="walletInfo"></div>
    <div id="transactionForm" style="display:none;">
        <h2>ارسال تراکنش</h2>
        <input type="text" id="recipientAddress" placeholder="آدرس گیرنده" />
        <input type="number" id="amount" placeholder="مقدار (TON)" />
        <button id="sendTransaction">ارسال تراکنش</button>
    </div>

    <script>
        let tonWeb = new TonWeb();  // راه‌اندازی TonWeb SDK
        let wallet = null;

        // اتصال به کیف پول
        document.getElementById('connectButton').addEventListener('click', async () => {
            try {
                wallet = await tonWeb.connectWallet();  // درخواست اتصال به کیف پول

                if (wallet) {
                    const address = await wallet.getAddress();
                    document.getElementById('walletInfo').innerHTML = `
                        <p>آدرس کیف پول شما: ${address}</p>
                        <button id="checkBalance">بررسی موجودی</button>
                        <button id="showTransactionForm">ارسال تراکنش</button>
                    `;
                }
            } catch (error) {
                console.error('اتصال به کیف پول با خطا مواجه شد: ', error);
                alert('خطا در اتصال به کیف پول');
            }
        });

        // بررسی موجودی کیف پول
        document.getElementById('checkBalance').addEventListener('click', async () => {
            try {
                const balance = await wallet.getBalance();
                alert(`موجودی کیف پول: ${balance / 1e9} TON`);
            } catch (error) {
                alert('خطا در دریافت موجودی');
            }
        });

        // نمایش فرم ارسال تراکنش
        document.getElementById('showTransactionForm').addEventListener('click', () => {
            document.getElementById('transactionForm').style.display = 'block';
        });

        // ارسال تراکنش
        document.getElementById('sendTransaction').addEventListener('click', async () => {
            const recipientAddress = document.getElementById('recipientAddress').value;
            const amount = document.getElementById('amount').value;

            if (!recipientAddress || !amount) {
                alert('لطفاً تمام فیلدها را پر کنید');
                return;
            }

            try {
                const txResult = await wallet.sendTransaction({
                    to: recipientAddress,
                    amount: amount * 1e9,  // مقدار به nanoTON تبدیل می‌شود
                });

                alert('تراکنش با موفقیت ارسال شد. شناسه تراکنش: ' + txResult.transaction_id);
            } catch (error) {
                alert('خطا در ارسال تراکنش');
            }
        });
    </script>
</body>
</html>
